<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <title>Online-Tagebuch ‚Äì Boleslawiec 2025</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <style>
    :root {
      --primary: #C23B33;        /* Haupt-Schulfarbe */
      --primary-light: #D35B51;  /* Helle Schulfarbe */
      --bg: #f7f3f3;
      --card-bg: #ffffff;
      --border: #e5e7eb;
      --text-main: #111827;
      --text-muted: #6b7280;
      --danger: #b91c1c;
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: radial-gradient(circle at top, #F2D2D0 0, #f7f3f3 45%, #eee 100%);
      color: var(--text-main);
    }

    .page {
      max-width: 960px;
      margin: 0 auto;
      padding: 1.5rem;
    }

    header {
      text-align: center;
      margin-bottom: 1.5rem;
    }

    header h1 {
      margin: 0;
      font-size: 2rem;
      letter-spacing: 0.03em;
      color: var(--primary);
    }

    header p {
      margin: 0.25rem 0 0;
      color: var(--text-muted);
      font-size: 0.95rem;
    }

    .tagline {
      display: inline-flex;
      align-items: center;
      gap: 0.4rem;
      margin-top: 0.8rem;
      padding: 0.35rem 0.8rem;
      border-radius: 999px;
      background: rgba(194, 59, 51, 0.08);
      color: var(--primary);
      font-size: 0.8rem;
      font-weight: 500;
    }

    .card {
      background: var(--card-bg);
      border-radius: 1rem;
      padding: 1.2rem 1.4rem;
      box-shadow:
        0 12px 30px rgba(15,23,42,0.12),
        0 0 0 1px rgba(148,163,184,0.25);
      border: 1px solid rgba(148,163,184,0.4);
    }

    .card + .card {
      margin-top: 1rem;
    }

    .grid {
      display: grid;
      grid-template-columns: minmax(0, 1.1fr) minmax(0, 1.2fr);
      gap: 1.5rem;
    }

    @media (max-width: 800px) {
      .grid {
        grid-template-columns: 1fr;
      }
    }

    h2 {
      margin: 0 0 1rem;
      font-size: 1.2rem;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    h2 span.icon {
      font-size: 1.2rem;
    }

    /* Formular */
    .form-row {
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 0.75rem;
    }

    .form-group {
      margin-bottom: 0.75rem;
    }

    label {
      display: block;
      font-size: 0.8rem;
      font-weight: 600;
      color: var(--text-muted);
      margin-bottom: 0.25rem;
      text-transform: uppercase;
      letter-spacing: 0.06em;
    }

    input, select, textarea {
      width: 100%;
      border-radius: 0.7rem;
      border: 1px solid var(--border);
      padding: 0.5rem 0.75rem;
      font: inherit;
      background: #f9fafb;
      transition: border-color 0.15s ease, box-shadow 0.15s ease, background 0.15s ease;
    }

    input:focus, select:focus, textarea:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 2px rgba(194,59,51,0.18);
      background: #ffffff;
    }

    textarea {
      resize: vertical;
      min-height: 130px;
    }

    .helper-text {
      font-size: 0.75rem;
      color: var(--text-muted);
      margin-top: 0.2rem;
    }

    .btn {
      border: none;
      border-radius: 999px;
      padding: 0.55rem 1.1rem;
      font: inherit;
      font-weight: 600;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 0.4rem;
      transition: transform 0.12s ease, box-shadow 0.12s ease, background 0.12s ease;
      background: var(--primary);
      color: #fef2f2;
      box-shadow: 0 8px 18px rgba(194,59,51,0.3);
    }

    .btn:hover {
      background: var(--primary-light);
      box-shadow: 0 12px 26px rgba(194,59,51,0.35);
      transform: translateY(-1px);
    }

    .btn:active {
      transform: translateY(0);
      box-shadow: 0 4px 10px rgba(194,59,51,0.25);
    }

    .btn-secondary {
      background: #e5e7eb;
      color: #111827;
      box-shadow: none;
    }

    .btn-secondary:hover {
      background: #d1d5db;
      box-shadow: none;
    }

    .btn-small {
      padding: 0.25rem 0.7rem;
      font-size: 0.75rem;
      border-radius: 999px;
    }

    .btn-danger {
      background: rgba(185,28,28,0.1);
      color: var(--danger);
      box-shadow: none;
    }

    .btn-danger:hover {
      background: rgba(185,28,28,0.18);
    }

    .actions {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-top: 0.4rem;
      gap: 0.5rem;
      flex-wrap: wrap;
    }

    .badge {
      display: inline-flex;
      align-items: center;
      gap: 0.25rem;
      border-radius: 999px;
      padding: 0.1rem 0.6rem;
      font-size: 0.7rem;
      font-weight: 500;
    }

    .badge-location {
      background: rgba(194,59,51,0.15);
      color: #7a1f19;
    }

    .badge-mood {
      background: rgba(211,91,81,0.18);
      color: #8b2f28;
    }

    .badge-date {
      background: rgba(15,23,42,0.06);
      color: #0f172a;
    }

    .entries-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 0.5rem;
      margin-bottom: 0.7rem;
    }

    .entries-header small {
      color: var(--text-muted);
      font-size: 0.8rem;
    }

    .entry {
      border-radius: 0.9rem;
      border: 1px solid rgba(148,163,184,0.5);
      padding: 0.8rem 0.9rem;
      margin-bottom: 0.6rem;
      background: rgba(248,250,252,0.9);
    }

    .entry-header {
      display: flex;
      justify-content: space-between;
      align-items: baseline;
      gap: 0.5rem;
      margin-bottom: 0.3rem;
    }

    .entry-title {
      font-weight: 600;
      font-size: 0.95rem;
    }

    .entry-meta {
      display: flex;
      flex-wrap: wrap;
      gap: 0.3rem;
      margin-bottom: 0.4rem;
    }

    .entry-text {
      font-size: 0.9rem;
      line-height: 1.4;
      white-space: pre-wrap;
      margin-bottom: 0.4rem;
    }

    .no-entries {
      font-size: 0.85rem;
      color: var(--text-muted);
      font-style: italic;
    }

    .pill-group {
      display: inline-flex;
      flex-wrap: wrap;
      gap: 0.3rem;
    }

    .pill {
      padding: 0.2rem 0.55rem;
      border-radius: 999px;
      font-size: 0.75rem;
      background: rgba(148,163,184,0.15);
      color: #374151;
    }

    footer {
      text-align: center;
      margin-top: 1.5rem;
      font-size: 0.8rem;
      color: var(--text-muted);
    }

    /* Bild & Karte */
    .entry-image {
      max-width: 100%;
      border-radius: 0.6rem;
      display: block;
      margin-bottom: 0.4rem;
      border: 1px solid rgba(148,163,184,0.5);
    }

    .image-preview {
      max-width: 100%;
      max-height: 160px;
      display: none;
      margin-top: 0.4rem;
      border-radius: 0.6rem;
      border: 1px solid rgba(148,163,184,0.5);
      object-fit: cover;
    }

    .map-container {
      margin-top: 0.4rem;
      border-radius: 0.6rem;
      overflow: hidden;
      border: 1px solid rgba(148,163,184,0.5);
    }

    .map-container iframe {
      width: 100%;
      height: 200px;
      border: 0;
    }

    .map-link {
      font-size: 0.8rem;
      margin-top: 0.25rem;
      display: inline-block;
    }
  </style>
</head>
<body>
  <div class="page">
    <header>
      <h1>Online-Tagebuch ‚Äì Boleslawiec 2025</h1>
      <p>Halte deine Erlebnisse, Bilder und Orte der Fahrt fest.</p>
      <div class="tagline">
        ‚úèÔ∏è <span>Text, Foto & Ort ‚Äì alles in einem Eintrag</span>
      </div>
    </header>

    <div class="grid">
      <!-- Formular-Card -->
      <section class="card">
        <h2><span class="icon">üìå</span> Neuer Eintrag</h2>

        <form id="entryForm">
          <div class="form-row">
            <div class="form-group">
              <label for="date">Datum</label>
              <input type="date" id="date" required>
            </div>
            <div class="form-group">
              <label for="place">Ort / Station</label>
              <input type="text" id="place" placeholder="z. B. Hotel" />
            </div>
          </div>

          <div class="form-group">
            <label for="title">√úberschrift</label>
            <input type="text" id="title" placeholder="z. B. Erster Tag ‚Äì Anreise & Chaos" required>
          </div>

          <div class="form-group">
            <label for="mood">Stimmung</label>
            <select id="mood">
              <option value="">‚Äì ausw√§hlen (optional) ‚Äì</option>
              <option value="Mega gut üòÑ">Mega gut üòÑ</option>
              <option value="Gut üôÇ">Gut üôÇ</option>
              <option value="M√ºde üò¥">M√ºde üò¥</option>
              <option value="Gestresst üòµ">Gestresst üòµ</option>
              <option value="Durchgefroren ü•∂">Durchgefroren ü•∂</option>
              <option value="Abenteuer pur ü§©">Abenteuer pur ü§©</option>
	      <option value="Gelangweilt">Gelangweilt </option>
            </select>
            <div class="helper-text">Optional ‚Äì hilft beim Erinnern der Stimmung.</div>
          </div>

          <div class="form-group">
            <label for="text">Was ist heute passiert?</label>
            <textarea id="text" placeholder="Highlights, Pannen, Insider-Spr√ºche, Ausfl√ºge ‚Ä¶" required></textarea>
          </div>

          <div class="form-group">
            <label for="photo">Foto hinzuf√ºgen (mit Geodaten m√∂glich)</label>
            <input type="file" id="photo" accept="image/*">
            <div class="helper-text">
              Wenn das Foto GPS-Daten enth√§lt, wird automatisch eine Karte mit dem Ort angezeigt.
            </div>
            <img id="photoPreview" class="image-preview" alt="Vorschau Bild">
            <div id="gpsInfo" class="helper-text"></div>
          </div>

          <div class="actions">
            <button type="submit" class="btn">
              üíæ Eintrag speichern
            </button>
            <button type="button" class="btn btn-secondary btn-small" id="clearFormBtn">
              Formular leeren
            </button>
          </div>
          <p class="helper-text">
            üí° Deine Eintr√§ge werden im Browser gespeichert (localStorage) ‚Äì sie bleiben auf diesem Ger√§t erhalten.
          </p>
        </form>
      </section>

      <!-- Eintr√§ge-Card -->
      <section class="card">
        <div class="entries-header">
          <h2><span class="icon">üìñ</span> Meine Eintr√§ge</h2>
          <small id="entryCountLabel">Keine Eintr√§ge vorhanden</small>
        </div>

        <div class="pill-group" style="margin-bottom: 0.4rem;">
          <span class="pill">Neueste Eintr√§ge zuerst</span>
          <span class="pill">Nur auf diesem Ger√§t gespeichert</span>
        </div>

        <div id="entriesContainer">
          <p class="no-entries">Noch keine Eintr√§ge. Starte mit deinem ersten Tag der Klassenfahrt! ‚ú®</p>
        </div>

        <div class="actions" style="margin-top: 0.8rem;">
          <button type="button" class="btn-danger btn-small" id="deleteAllBtn">
            üóëÔ∏è Alle Eintr√§ge l√∂schen
          </button>
        </div>
      </section>
    </div>

    <footer>
      Klassenfahrt-Tagebuch ‚Äì erstellt mit üíô im Browser ¬∑ Daten bleiben auf deinem Ger√§t
    </footer>
  </div>

  <!-- EXIF-Bibliothek f√ºr GPS aus Bildern -->
  <script src="https://cdn.jsdelivr.net/npm/exif-js"></script>

  <script>
    (function () {
      const STORAGE_KEY = "klassenfahrtDiaryEntries";

      const entryForm = document.getElementById("entryForm");
      const dateInput = document.getElementById("date");
      const placeInput = document.getElementById("place");
      const titleInput = document.getElementById("title");
      const moodInput = document.getElementById("mood");
      const textInput = document.getElementById("text");
      const photoInput = document.getElementById("photo");
      const photoPreview = document.getElementById("photoPreview");
      const gpsInfo = document.getElementById("gpsInfo");

      const entriesContainer = document.getElementById("entriesContainer");
      const entryCountLabel = document.getElementById("entryCountLabel");
      const clearFormBtn = document.getElementById("clearFormBtn");
      const deleteAllBtn = document.getElementById("deleteAllBtn");

      let entries = [];

      // Variablen f√ºr das aktuell ausgew√§hlte Foto
      let currentImageDataUrl = null;
      let currentImageGps = null; // {lat, lng}

      function todayAsInputValue() {
        const d = new Date();
        const year = d.getFullYear();
        const month = String(d.getMonth() + 1).padStart(2, "0");
        const day = String(d.getDate()).padStart(2, "0");
        return `${year}-${month}-${day}`;
      }

      function loadEntries() {
        try {
          const raw = localStorage.getItem(STORAGE_KEY);
          entries = raw ? JSON.parse(raw) : [];
        } catch (e) {
          console.error("Fehler beim Laden:", e);
          entries = [];
        }
      }

      function saveEntries() {
        localStorage.setItem(STORAGE_KEY, JSON.stringify(entries));
      }

      function formatDateForDisplay(dateStr) {
        if (!dateStr) return "Ohne Datum";
        const d = new Date(dateStr);
        if (Number.isNaN(d.getTime())) return dateStr;
        const options = { day: "2-digit", month: "2-digit", year: "numeric" };
        return d.toLocaleDateString("de-DE", options);
      }

      function renderEntries() {
        entriesContainer.innerHTML = "";

        if (!entries.length) {
          entriesContainer.innerHTML =
            '<p class="no-entries">Noch keine Eintr√§ge. Starte mit deinem ersten Tag der Klassenfahrt! ‚ú®</p>';
          entryCountLabel.textContent = "Keine Eintr√§ge vorhanden";
          return;
        }

        const sorted = [...entries].sort((a, b) => {
          const da = a.date || "";
          const db = b.date || "";
          if (da === db) {
            return (b.createdAt || 0) - (a.createdAt || 0);
          }
          return db.localeCompare(da);
        });

        sorted.forEach(entry => {
          const entryEl = document.createElement("article");
          entryEl.className = "entry";

          const headerEl = document.createElement("div");
          headerEl.className = "entry-header";

          const titleEl = document.createElement("div");
          titleEl.className = "entry-title";
          titleEl.textContent = entry.title || "Ohne Titel";

          const dateBadge = document.createElement("span");
          dateBadge.className = "badge badge-date";
          dateBadge.textContent = formatDateForDisplay(entry.date);

          headerEl.appendChild(titleEl);
          headerEl.appendChild(dateBadge);

          const metaEl = document.createElement("div");
          metaEl.className = "entry-meta";

          if (entry.place) {
            const placeBadge = document.createElement("span");
            placeBadge.className = "badge badge-location";
            placeBadge.textContent = "üìç " + entry.place;
            metaEl.appendChild(placeBadge);
          }

          if (entry.mood) {
            const moodBadge = document.createElement("span");
            moodBadge.className = "badge badge-mood";
            moodBadge.textContent = "Stimmung: " + entry.mood;
            metaEl.appendChild(moodBadge);
          }

          const textEl = document.createElement("div");
          textEl.className = "entry-text";
          textEl.textContent = entry.text || "";

          entryEl.appendChild(headerEl);
          entryEl.appendChild(metaEl);
          entryEl.appendChild(textEl);

          // Bild einf√ºgen
          if (entry.imageDataUrl) {
            const img = document.createElement("img");
            img.className = "entry-image";
            img.src = entry.imageDataUrl;
            img.alt = "Foto zum Tagebucheintrag";
            entryEl.insertBefore(img, textEl); // Bild vor dem Text
          }

          // Karte einf√ºgen, falls GPS vorhanden
          if (entry.gps && typeof entry.gps.lat === "number" && typeof entry.gps.lng === "number") {
            const mapContainer = document.createElement("div");
            mapContainer.className = "map-container";

            const iframe = document.createElement("iframe");
            const lat = entry.gps.lat;
            const lng = entry.gps.lng;
            const mapUrl = `https://www.google.com/maps?q=${lat},${lng}&z=14&output=embed`;
            iframe.src = mapUrl;
            iframe.loading = "lazy";

            mapContainer.appendChild(iframe);
            entryEl.appendChild(mapContainer);

            const link = document.createElement("a");
            link.href = `https://www.google.com/maps?q=${lat},${lng}`;
            link.target = "_blank";
            link.rel = "noopener noreferrer";
            link.className = "map-link";
            link.textContent = "üåç In Google Maps √∂ffnen";
            entryEl.appendChild(link);
          }

          const actionsEl = document.createElement("div");
          actionsEl.className = "actions";
          actionsEl.style.marginTop = "0.5rem";

          const timeInfo = document.createElement("span");
          timeInfo.className = "helper-text";
          if (entry.createdAt) {
            const created = new Date(entry.createdAt);
            const timeString = created.toLocaleTimeString("de-DE", {
              hour: "2-digit",
              minute: "2-digit"
            });
            timeInfo.textContent = "Erstellt um " + timeString;
          } else {
            timeInfo.textContent = "";
          }

          const deleteBtn = document.createElement("button");
          deleteBtn.type = "button";
          deleteBtn.className = "btn btn-danger btn-small";
          deleteBtn.textContent = "L√∂schen";
          deleteBtn.addEventListener("click", () => {
            if (confirm("Diesen Eintrag wirklich l√∂schen?")) {
              entries = entries.filter(e => e.id !== entry.id);
              saveEntries();
              renderEntries();
            }
          });

          actionsEl.appendChild(timeInfo);
          actionsEl.appendChild(deleteBtn);

          entryEl.appendChild(actionsEl);

          entriesContainer.appendChild(entryEl);
        });

        entryCountLabel.textContent =
          entries.length === 1
            ? "1 Eintrag gespeichert"
            : entries.length + " Eintr√§ge gespeichert";
      }

      function resetForm() {
        dateInput.value = todayAsInputValue();
        placeInput.value = "";
        titleInput.value = "";
        moodInput.value = "";
        textInput.value = "";
        photoInput.value = "";
        photoPreview.src = "";
        photoPreview.style.display = "none";
        gpsInfo.textContent = "";
        currentImageDataUrl = null;
        currentImageGps = null;
      }

      // Hilfsfunktionen f√ºr EXIF-GPS
      function gpsToDecimal(gpsData, ref) {
        if (!gpsData || gpsData.length !== 3) return null;
        const d = gpsData[0];
        const m = gpsData[1];
        const s = gpsData[2];
        const deg = d.numerator / d.denominator;
        const min = m.numerator / m.denominator;
        const sec = s.numerator / s.denominator;
        let dec = deg + min / 60 + sec / 3600;
        if (ref === "S" || ref === "W") {
          dec = -dec;
        }
        return dec;
      }

      // Foto-Auswahl: Bild + GPS einlesen
      photoInput.addEventListener("change", () => {
        const file = photoInput.files && photoInput.files[0];
        currentImageDataUrl = null;
        currentImageGps = null;
        gpsInfo.textContent = "";
        photoPreview.src = "";
        photoPreview.style.display = "none";

        if (!file) return;

        const reader = new FileReader();
        reader.onload = function (e) {
          const dataUrl = e.target.result;
          currentImageDataUrl = dataUrl;
          photoPreview.src = dataUrl;
          photoPreview.style.display = "block";

          // EXIF auslesen
          const img = new Image();
          img.onload = function () {
            EXIF.getData(img, function () {
              const lat = EXIF.getTag(this, "GPSLatitude");
              const latRef = EXIF.getTag(this, "GPSLatitudeRef");
              const lng = EXIF.getTag(this, "GPSLongitude");
              const lngRef = EXIF.getTag(this, "GPSLongitudeRef");

              if (lat && latRef && lng && lngRef) {
                const latDec = gpsToDecimal(lat, latRef);
                const lngDec = gpsToDecimal(lng, lngRef);
                if (latDec != null && lngDec != null) {
                  currentImageGps = { lat: latDec, lng: lngDec };
                  gpsInfo.textContent =
                    "üìç GPS erkannt: " +
                    latDec.toFixed(5) + ", " + lngDec.toFixed(5) +
                    " (f√ºr Karte gespeichert)";
                } else {
                  gpsInfo.textContent = "Keine verwendbaren GPS-Daten im Bild gefunden.";
                }
              } else {
                gpsInfo.textContent = "Keine GPS-Daten im Bild vorhanden.";
              }
            });
          };
          img.src = dataUrl;
        };

        reader.readAsDataURL(file);
      });

      entryForm.addEventListener("submit", (event) => {
        event.preventDefault();

        const date = dateInput.value;
        const place = placeInput.value.trim();
        const title = titleInput.value.trim();
        const mood = moodInput.value.trim();
        const text = textInput.value.trim();

        if (!title || !text) {
          alert("Bitte mindestens √úberschrift und Text ausf√ºllen.");
          return;
        }

        const newEntry = {
          id: Date.now(),
          date,
          place,
          title,
          mood,
          text,
          createdAt: Date.now(),
          imageDataUrl: currentImageDataUrl,
          gps: currentImageGps
        };

        entries.push(newEntry);
        saveEntries();
        renderEntries();
        resetForm();
      });

      clearFormBtn.addEventListener("click", () => {
        resetForm();
      });

      deleteAllBtn.addEventListener("click", () => {
        if (!entries.length) return;
        const really = confirm("Wirklich alle Eintr√§ge l√∂schen? Dies kann nicht r√ºckg√§ngig gemacht werden.");
        if (!really) return;
        entries = [];
        saveEntries();
        renderEntries();
      });

      // Initial
      dateInput.value = todayAsInputValue();
      loadEntries();
      renderEntries();
    })();
  </script>
</body>
</html>
